# Как работает CSRF?
Чтобы CSRF стала возможной, необходимо наличие трех ключевых условий:
- Соответствующее действие. В приложении есть действие, которое злоумышленник имеет основания вызвать. Это может быть привилегированное действие (например, изменение разрешений для других пользователей) или любое действие над данными конкретного пользователя (например, изменение собственного пароля).
- Обработка сеанса на основе куки. Выполнение действия подразумевает выдачу одного или нескольких HTTP-запросов, и приложение полагается исключительно на куки сеанса для идентификации пользователя, выполнившего эти запросы. Нет никаких других механизмов для отслеживания сеансов или проверки запросов пользователя.
- Отсутствие непредсказуемых параметров запроса. Запросы, выполняющие действие, не содержат параметров, значения которых злоумышленник не может определить или угадать. Например, заставляя пользователя сменить пароль, функция не уязвима, если злоумышленнику необходимо знать значение существующего пароля.

Примечание:
>Хотя CSRF обычно описывается в связи с обработкой сеанса на основе cookie, он также возникает в других контекстах, когда приложение автоматически добавляет некоторые учетные данные пользователя к запросам, например, при аутентификации HTTP Basic и аутентификации на основе сертификатов.

Например, приложение содержит функцию, позволяющую пользователю изменить адрес электронной почты в своей учетной записи:

```http
POST /email/change HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 30
Cookie: session=yvthwsztyeQkAPzeQ5gHgTvlyxHfsAfE

email=wiener@normal-user.com
```
  
Можно создать страницу, содержащую следующий HTML:

```html
<html>
    <body>
        <form action="https://vulnerable-website.com/email/change" method="POST">
            <input type="hidden" name="email" value="pwned@evil-user.net" />
        </form>
        <script> document.forms[0].submit(); </script>
    </body>
</html>
```

Если пользователь созданную страницу, произойдет следующее:
- Страница вызовет HTTP-запрос на уязвимый веб-сайт.
- Если пользователь вошел на уязвимый сайт, его браузер автоматически включит в запрос сессионный файл cookie (при условии, что не используются SameSite cookie).
- Уязвимый веб-сайт обработает запрос обычным образом, расценит его как сделанный пользователем-жертвой и изменит его адрес электронной почты.

# Common defences against CSRF
## CSRF токены


## SameSite cookie


## Refer-based валидация

